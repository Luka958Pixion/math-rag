Bootstrap: docker
From: python:3.11

%environment
    export PYTHONUNBUFFERED=1
    export HF_HUB_ENABLE_HF_TRANSFER=1
    export HF_HUB_DOWNLOAD_TIMEOUT=300

%post
    mkdir -p /data
    pip install --upgrade pip
    pip install huggingface_hub hf_transfer

%runscript
    huggingface-cli login --token "$HF_TOKEN"
    huggingface-cli download "$TGI_MODEL" --local-dir "/data/$TGI_MODEL" --local-dir-use-symlinks False

%labels
    Author luka.panic@pixion.co
    Version v0.0.1

%help
    Description:
        A client for Hugging Face Hub.

    Build:
        apptainer build hf_cli.sif hf_cli.def

    Environment:
        - HF_TOKEN
        - TGI_MODEL

    Usage:
        apptainer run --nv --bind $PWD/data:/data hf_cli.sif